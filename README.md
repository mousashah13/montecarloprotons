# montecarloprotons
The Monte Carlo method uses random angles of deflection in a photon’s trajectory while scattering is accused. The flowchart in questions shows the photon tracing part of a Monte Carlo simulation under some turbid medium. For a photon to propagate through a biological medium, the photon launched is chosen repeatedly in the form of a packet over a large range using the probability density function. The photons launched are based on their cartesian coordinates which gives their location of emission and transmission. Photons are captured as long as they are in the form of a randomized packet, all propagating through a single pathway at the same time. The photons are given an initial weight W which is found by dividing the total power of the light source with the total number of photons. The initial position of the photon is found via random sampling. The initial direction is determined using a spherical coordinate system as opposed to the position over 0 to 2pi while the deflection angle is over 0 to pi.

When launched, the photon travels through the turbid medium. The step size of the photon is found here. A photon takes a step whose length is exponentially distributed. This length depends on the total attenuation coefficient which is made from the absorption coeffection and the scattering coefficient added together. The photon once launched is either absorbed, scattered, reflected or transmitted once hitting the tissue boundary.

The photon is reflected when the boundary and medium of the tissue are of different refractive indices. The critical angle and the internal reflectance determines if a photon is transmitted out the tissue or is reflected. If the critical angle is less than the internal reflectance, the photon experiences total reflection. If the photon is transmitted at the boundary, the photon is terminated and the residual power of the photon is calculated in a transmission matrix. If the boundary is internal and not exterior, the photon continues to travel through the tissue with a new step size and a new, randomized direction.

Photons only interact with the tissue medium if the packet travels via a value of -ln(E). A photon packet can travel multiple substeps of size s to interact with the tissue at different sites after entry. Interactions in the tissue are absorption or scattering now that transmission is out of the equation. A photon only moves wi9th a determined substep and step size. An absorbed photon undergoes physical changes so some of its initial weight W is absorbed by the tissue and this is also recorded. If the photon fails to scatter, the photon weight is stored since it should decrease after tissue interaction.

When a photon scatters through tissue, it loses weight. Deflection occurs when the photon scatters through the tissue using the Heyney Greenstein phase function. This function determines the isotropy of the photon which is denoted as g. When g= o, isotropic scattering occurs. When g= 1, forward scattering occurs which is ideal for the monte carlo simulation. Successful propagation in the tissue is about 0.9 for the given flowchart. With a step size of s, the photon either hits the boundary of the layer it is going through, which may be a tissue-tissue or ambient medium-tissue interaction. The photon can be internally reflected and transmitted out the boundary however. If the photon is reflected back into the same layer that it was while propagating through the tissue, the photon packets continue traveling down the tissue for a successful monte carlo simulation. 
If the photon (as part of the photon packet) does hit the boundary, the probability of it being internally reflected is computed which depends on the incident angle. Snell’s law is used to determine the relationship between the incident angle, the transmitted angle and the refractive index of the medium the tissue is incident from. The light in the Monte Carlo simulation is assumed to have 0 polarization. If the photon does experience internal reflection, the photon stays on the boundary and its directional cosines are accordingly changed. If the photon does enter the next layer of tissue, as it should, it continues traveling with a successful simulation but under a new direction and size. The substep is recalculated every time this happens.

Photons may experience extinction as well. The extinction coefficient for the photon is calculated for the layer of tissue it currently propagates through. If the photon packet hits a boundary, the specular reflectance is calculated using the refractive indices of the transmitted and incident media. Reemission of a photon is also possible. A fraction of the current weight is re-emitted from the scattering medium and the photon with new weight further travels. Photons that escape the medium are no longer traced so photons are either reemitted or launched again.

Termination of a photon can occur either by reflection or transmission out the tissue. If a photon's weight is so decreased beyond the given threshold weight, tracing of this photon is not computed in the simulation. Proper deliberate termination is still essential without altering the distribution of the photons to conserve energy. Russian Roulette is used to terminate the photon when it is below the threshold weight. This method gives the photon a small chance of survival and if it does not, the weight is considered 0 and the photon is terminated.
